<div class="card">
  <div class="card-header">
    <h2>{{ isEditMode ? 'Cập nhật đăng ký' : 'Tạo đăng ký mới' }}</h2>
    <a class="btn" routerLink="/admin/enrollments">Quay lại</a>
  </div>

  <form [formGroup]="enrollmentForm" (ngSubmit)="onSubmit()">
    <div class="grid">
      <div class="col">
        <label>Sinh viên <span class="req">*</span></label>
        <select formControlName="studentId" [disabled]="isEditMode">
          <option value="">-- Chọn sinh viên --</option>
          <option *ngFor="let s of students" [value]="s.studentId">
            {{ s.studentId }} - {{ s.fullName || s.studentId }}
          </option>
        </select>
      </div>

      <div class="col">
        <label>Môn học <span class="req">*</span></label>
        <select formControlName="courseId" [disabled]="isEditMode">
          <option value="">-- Chọn môn học --</option>
          <option *ngFor="let c of courses" [value]="c.courseId">
            {{ c.courseId }} - {{ c.courseName }}
          </option>
        </select>
      </div>

      <div class="col">
        <label>Lớp giảng dạy (Teacher Course)</label>
        <select formControlName="teacherCourseId">
          <option [ngValue]="null">-- Chưa phân công --</option>
          <option *ngFor="let tc of teacherCourses" [ngValue]="tc.teacherCourseId">
            {{
              tc.teacher?.fullName
              || tc.teacher?.teacherId
              || tc.teacherId
              || ('TC#' + tc.teacherCourseId)
            }}
          </option>
        </select>
        <div class="hint">Chọn lớp giảng dạy tương ứng (nếu có)</div>
      </div>

      <div class="col">
        <label>Học kỳ <span class="req">*</span></label>
        <select formControlName="semesterId">
          <option [ngValue]="null">-- Chọn học kỳ --</option>
          <option *ngFor="let sem of semesters" [ngValue]="sem.semesterId">
            {{ sem.semesterName }} ({{ sem.academicYear }})
          </option>
        </select>
      </div>

      <div class="col">
        <label>Trạng thái <span class="req">*</span></label>
        <select formControlName="status">
          <option value="Enrolled">Enrolled</option>
          <option value="Dropped">Dropped</option>
          <option value="Completed">Completed</option>
        </select>
      </div>
    </div>

    <div class="actions">
      <button type="button" class="btn" routerLink="/admin/enrollments">Hủy</button>
      <button type="submit" class="btn primary" [disabled]="enrollmentForm.invalid || isLoading">
        {{ isLoading ? 'Đang lưu...' : (isEditMode ? 'Cập nhật' : 'Tạo mới') }}
      </button>
    </div>
  </form>
</div>
