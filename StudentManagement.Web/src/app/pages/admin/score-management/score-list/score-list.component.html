<div class="management-container">
  <header class="management-header">
    <h1>Qu·∫£n l√Ω ƒêi·ªÉm s·ªë</h1>
    <div class="breadcrumb">
      <span *ngIf="level >= 1" class="active">M√¥n h·ªçc</span>
      <span *ngIf="level >= 2"> > Gi·∫£ng vi√™n</span>
      <span *ngIf="level >= 3"> > ƒêi·ªÉm s·ªë</span>
    </div>
  </header>

  <div *ngIf="isLoading" class="loading-indicator">
    <div class="spinner"></div>
    <span>ƒêang t·∫£i d·ªØ li·ªáu...</span>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
    <button (click)="errorMessage = null" class="btn-close">√ó</button>
  </div>

  <!-- T·∫¶NG 1: CH·ªåN M√îN H·ªåC - D·∫†NG LIST -->
  <div *ngIf="level === 1 && !isLoading" class="level-container">
    <div class="level-header">
      <h2>Ch·ªçn m√¥n h·ªçc</h2>
    </div>

    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>M√£ m√¥n h·ªçc</th>
            <th>T√™n m√¥n h·ªçc</th>
            <th>S·ªë t√≠n ch·ªâ</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let course of courses; trackBy: trackByCourseId"
            class="clickable-row">
            <td class="course-id">{{ course.courseId }}</td>
            <td class="course-name">{{ course.courseName }}</td>
            <td class="course-credits">{{ course.credits }} t√≠n ch·ªâ</td>
            <td>
              <button
                class="btn btn-primary"
                (click)="selectCourse(course)">
                Ch·ªçn m√¥n h·ªçc
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="courses.length === 0" class="no-data">
      Kh√¥ng c√≥ m√¥n h·ªçc n√†o.
    </div>
  </div>

  <!-- T·∫¶NG 2: CH·ªåN GI·∫¢NG VI√äN -->
  <div *ngIf="level === 2 && !isLoading" class="level-container">
    <div class="level-header">
      <button class="btn-back" (click)="goBack()">‚Üê Quay l·∫°i</button>
      <h2>Ch·ªçn gi·∫£ng vi√™n - {{ selectedCourse?.courseName }}</h2>
    </div>

    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>M√£ GV</th>
            <th>T√™n gi·∫£ng vi√™n</th>
            <th>M√£ ph√¢n c√¥ng</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let teacher of assignedTeachers; trackBy: trackByTeacherId"
            class="clickable-row">
            <td>{{ teacher.teacherId }}</td>
            <td>{{ teacher.teacherName }}</td>
            <td>{{ teacher.teacherCourseId }}</td>
            <td>
              <button
                class="btn btn-primary"
                (click)="selectTeacher(teacher.teacherId, teacher.teacherCourseId)">
                Xem ƒëi·ªÉm
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="assignedTeachers.length === 0" class="no-data">
      Ch∆∞a c√≥ gi·∫£ng vi√™n n√†o ƒë∆∞·ª£c ph√¢n c√¥ng d·∫°y m√¥n n√†y.
    </div>
  </div>

  <!-- T·∫¶NG 3: DANH S√ÅCH ƒêI·ªÇM -->
  <div *ngIf="level === 3 && !isLoading" class="level-container">
    <div class="level-header">
      <div class="header-left">
        <button class="btn-back" (click)="goBack()">‚Üê Quay l·∫°i</button>
        <h2>
          ƒêi·ªÉm s·ªë - {{ selectedCourse?.courseName }}
          (GV: {{ selectedTeacherName }})
        </h2>
      </div>
      <div class="header-actions">
        <button
          class="btn btn-primary"
          (click)="navigateToAddScore()"
          title="Th√™m ƒëi·ªÉm cho sinh vi√™n">
          ‚ûï Th√™m ƒëi·ªÉm
        </button>
        <button
          class="btn btn-success"
          (click)="saveAllScores()"
          [disabled]="scores.length === 0">
          üíæ L∆∞u t·∫•t c·∫£ ƒëi·ªÉm
        </button>
      </div>
    </div>

    <div class="table-container">
      <table class="table scores-table">
        <thead>
          <tr>
            <th>M√£ SV</th>
            <th>H·ªç t√™n</th>
            <th>ƒêi·ªÉm qu√° tr√¨nh</th>
            <th>ƒêi·ªÉm gi·ªØa k·ª≥</th>
            <th>ƒêi·ªÉm cu·ªëi k·ª≥</th>
            <th>ƒêi·ªÉm t·ªïng</th>
            <th>K·∫øt qu·∫£</th>
            <th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let score of scores; trackBy: trackByScoreId">
            <td>{{ score.studentId }}</td>
            <td>{{ score.fullName }}</td>
            <td>
              <input
                type="number"
                [(ngModel)]="score.processScore"
                min="0"
                max="10"
                step="0.1"
                class="score-input"
                (input)="score.totalScore = calculateTotalScore(score); score.isPassed = score.totalScore >= 4">
            </td>
            <td>
              <input
                type="number"
                [(ngModel)]="score.midtermScore"
                min="0"
                max="10"
                step="0.1"
                class="score-input"
                (input)="score.totalScore = calculateTotalScore(score); score.isPassed = score.totalScore >= 4">
            </td>
            <td>
              <input
                type="number"
                [(ngModel)]="score.finalScore"
                min="0"
                max="10"
                step="0.1"
                class="score-input"
                (input)="score.totalScore = calculateTotalScore(score); score.isPassed = score.totalScore >= 4">
            </td>
            <td class="total-score">{{ score.totalScore?.toFixed(2) || '0.00' }}</td>
            <td>
              <span class="badge" [class.passed]="score.isPassed" [class.failed]="!score.isPassed">
                {{ score.isPassed ? 'ƒê·∫≠u' : 'R·ªõt' }}
              </span>
            </td>
            <td>
              <button
                class="btn btn-danger btn-sm"
                (click)="deleteScore(score.scoreId)"
                title="X√≥a ƒëi·ªÉm">
                X√≥a
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="scores.length === 0" class="no-data">
      Ch∆∞a c√≥ ƒëi·ªÉm n√†o cho l·ªõp h·ªçc n√†y.
    </div>
  </div>
</div>
