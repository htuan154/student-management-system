<div class="dashboard">
  <!-- Header -->
  <header class="dash-header">
    <div class="titles">
      <h1><i class="fas fa-tachometer-alt"></i> Bảng điều khiển</h1>
      <p class="subtitle">Tổng quan hệ thống quản lý</p>
    </div>
  </header>

  <!-- Loading -->
  <section *ngIf="isLoading" class="state-block">
    <div class="spinner"></div>
    <p>Đang tải dữ liệu…</p>
  </section>

  <!-- Error -->
  <section *ngIf="!isLoading && errorMessage" class="state-block error">
    <i class="fas fa-exclamation-triangle"></i>
    <p>{{ errorMessage }}</p>
  </section>

  <!-- Content -->
  <section *ngIf="!isLoading && !errorMessage" class="dash-content">
    <!-- Stats cards -->
    <div class="stats-grid">
      <article class="stat-card accent-blue">
        <div class="icon"><i class="fas fa-users"></i></div>
        <div class="meta">
          <div class="value">{{ stats.users | number }}</div>
          <div class="label">Tổng người dùng</div>
          <small class="hint">Đang hoạt động</small>
        </div>
      </article>

      <article class="stat-card accent-green">
        <div class="icon"><i class="fas fa-user-graduate"></i></div>
        <div class="meta">
          <div class="value">{{ stats.students | number }}</div>
          <div class="label">Sinh viên</div>
          <small class="hint">Đã đăng ký</small>
        </div>
      </article>

      <article class="stat-card accent-cyan">
        <div class="icon"><i class="fas fa-chalkboard-teacher"></i></div>
        <div class="meta">
          <div class="value">{{ stats.teachers | number }}</div>
          <div class="label">Giáo viên</div>
          <small class="hint">Đang giảng dạy</small>
        </div>
      </article>

      <article class="stat-card accent-amber">
        <div class="icon"><i class="fas fa-book"></i></div>
        <div class="meta">
          <div class="value">{{ stats.courses | number }}</div>
          <div class="label">Khóa học</div>
          <small class="hint">Đang mở</small>
        </div>
      </article>
    </div>

    <!-- Top students -->
    <article class="card">
      <header class="card-head">
        <div class="card-title">
          <i class="fas fa-trophy"></i>
          <h2>Top sinh viên theo điểm trung bình</h2>
        </div>

        <div class="pager" aria-label="Điều hướng trang Top sinh viên">
          <button class="btn" (click)="goPrev()" [disabled]="!canPrev()">
            <i class="fas fa-angle-left"></i> Trước
          </button>
          <span class="page-indicator">Trang <strong>{{ topPage }}</strong> / {{ totalPages }}</span>
          <button class="btn" (click)="goNext()" [disabled]="!canNext()">
            Sau <i class="fas fa-angle-right"></i>
          </button>
        </div>
      </header>

      <div class="card-body">
        <div *ngIf="topLoading" class="inline-loading">
          <div class="spinner sm"></div>
          <span>Đang tải Top sinh viên…</span>
        </div>

        <div *ngIf="topError" class="inline-error">
          <i class="fas fa-info-circle"></i> {{ topError }}
        </div>

        <div class="table-wrap" *ngIf="!topLoading && !topError">
          <table class="table">
            <colgroup>
              <col style="width:72px">
              <col style="width:140px">
              <col>
              <col style="width:140px">
              <col style="width:140px">
            </colgroup>
            <thead>
              <tr>
                <th>#</th>
                <th>MSSV</th>
                <th>Họ tên</th>
                <th>Lớp</th>
                <th>Điểm TB</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let s of topStudents; let i = index">
                <td>{{ (topPage - 1) * topSize + i + 1 }}</td>
                <td><span class="mono">{{ s.studentId }}</span></td>
                <td>{{ s.fullName }}</td>
                <td>{{ s.className }}</td>
                <td>
                  <span class="chip"
                        [class.good]="s.averageScore >= 8"
                        [class.medium]="s.averageScore >= 6 && s.averageScore < 8"
                        [class.bad]="s.averageScore < 6">
                    {{ s.averageScore | number:'1.2-2' }}
                  </span>
                </td>
              </tr>
              <tr *ngIf="topStudents.length === 0">
                <td colspan="5" class="empty">Chưa có dữ liệu.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </article>
  </section>
</div>
