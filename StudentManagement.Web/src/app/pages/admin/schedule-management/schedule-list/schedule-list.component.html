<div class="management-container">
  <!-- Header -->
  <header class="management-header">
    <div class="header-top">
      <h1>Quản lý Lịch học</h1>
      <div class="header-stats">
        <span>Tổng: <strong>{{ schedules?.length || 0 }}</strong></span>
      </div>
    </div>

    <div class="header-actions">
      <div class="search-box">
        <input type="text" class="search-input" placeholder="Tìm kiếm lịch học..." #searchInput />
        <i class="fas fa-search search-icon"></i>
      </div>
      <a routerLink="new" class="btn btn-primary">
        <i class="fas fa-plus"></i><span>Thêm lịch học</span>
      </a>
    </div>
  </header>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-indicator">
    <div class="spinner"></div>
    <p>Đang tải danh sách lịch học...</p>
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="error-message">
    <i class="fas fa-exclamation-circle"></i>
    <p>{{ errorMessage }}</p>
  </div>

  <!-- Table -->
  <div *ngIf="!isLoading && !errorMessage" class="table-container">
    <div class="desktop-table">
      <table class="table">
        <thead>
          <tr>
            <th class="col-id">ID</th>
            <th class="col-course">Môn học</th>
            <th class="col-teacher">Giảng viên</th>
            <th class="col-day">Thứ</th>
            <th class="col-time">Thời gian</th>
            <th class="col-room">Phòng</th>
            <th class="col-location">Địa điểm</th>
            <th class="col-actions">Hành động</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let schedule of schedules; trackBy: trackById">
            <!-- ID -->
            <td><span class="badge badge-id">{{ schedule.scheduleId }}</span></td>

            <!-- Course -->
            <td>
              <ng-container *ngIf="schedule.teacherCourse as tc; else noCourse">
                <div class="course-info" [title]="tc.course?.courseId">
                  <span class="course-name">{{ tc.course?.courseName }}</span>
                  <span class="course-code">{{ tc.course?.courseId }}</span>
                </div>
              </ng-container>
              <ng-template #noCourse>
                <span class="muted">N/A</span>
              </ng-template>
            </td>

            <!-- Teacher -->
            <td>
              <ng-container *ngIf="schedule.teacherCourse as tc2; else noTeacher">
                <div class="teacher-info">
                  <span class="teacher-name">{{ tc2.teacher?.fullName }}</span>
                </div>
              </ng-container>
              <ng-template #noTeacher>
                <span class="muted">N/A</span>
              </ng-template>
            </td>

            <!-- Day -->
            <td><span class="day-badge">{{ dayOfWeekMap[schedule.dayOfWeek] || ('Thứ ' + schedule.dayOfWeek) }}</span></td>

            <!-- Time -->
            <td>
              <div class="time-info">
                <span class="time-range">{{ fmt(schedule.startTime) }} - {{ fmt(schedule.endTime) }}</span>
              </div>
            </td>

            <!-- Room -->
            <td><span class="room-badge">{{ schedule.roomNumber || 'Chưa xác định' }}</span></td>

            <!-- Location -->
            <td><span class="location">{{ schedule.location || 'Chưa xác định' }}</span></td>

            <!-- Actions -->
            <td class="col-actions">
              <div class="action-buttons">
                <a [routerLink]="['edit', schedule.scheduleId]" class="btn btn-info">
                  <i class="fas fa-edit"></i><span class="btn-text">Sửa</span>
                </a>
                <button (click)="deleteSchedule(schedule.scheduleId)" class="btn btn-danger">
                  <i class="fas fa-trash-alt"></i><span class="btn-text">Xóa</span>
                </button>
              </div>
            </td>
          </tr>

          <!-- Empty state -->
          <tr *ngIf="schedules?.length === 0">
            <td colspan="8" class="no-data-cell">
              <div class="no-data">
                <i class="fas fa-calendar-times no-data-icon"></i>
                <h3>Không có lịch học nào</h3>
                <p>Chưa có lịch học được tạo. Nhấp vào "Thêm lịch học" để bắt đầu.</p>
                <a routerLink="new" class="btn btn-primary"><i class="fas fa-plus"></i> Thêm lịch học đầu tiên</a>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!-- Footer: phân trang -->
<div class="table-footer">
  <div class="hint">
    Hiển thị
    {{ (totalCount === 0) ? 0 : ((currentPage - 1) * pageSize + 1) }}
    –
    {{ ((currentPage * pageSize) > totalCount) ? totalCount : (currentPage * pageSize) }}
    trong tổng số {{ totalCount }} lịch học
  </div>

  <div class="pager">
    <select class="page-size"
            [ngModel]="pageSize"
            (ngModelChange)="changePageSize(+$event)">
      <option [ngValue]="5">5 / trang</option>
      <option [ngValue]="10">10 / trang</option>
      <option [ngValue]="20">20 / trang</option>
      <option [ngValue]="50">50 / trang</option>
    </select>

    <button class="page-btn" (click)="prev()" [disabled]="currentPage === 1">&laquo;</button>
    <button class="page-btn"
            *ngFor="let p of pages"
            (click)="goToPage(p)"
            [class.is-active]="currentPage === p">
      {{ p }}
    </button>
    <button class="page-btn" (click)="next()" [disabled]="currentPage >= totalPages">&raquo;</button>
  </div>
</div>

</div>
